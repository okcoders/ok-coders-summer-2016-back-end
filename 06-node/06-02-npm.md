NPM: Node Package Manager
====================================

As soon as we start building more complex applications that involve more than one javascript file and may rely on 3rd party modules, we should order our application as a *package*.

For node, a package is a self-contained collection of javascript files and other resources with accompanying metadata that describes what it does and what other code it depends on. Node includes a special utility, *npm* or the *node package manager* that makes it easy to mangage packages.

Node treats packages like modules. Although a package may contain may files, it also indicates a *main* file or public facing file that represents the package to its consumers as a module.

## Resources

[Node Modules](http://nodejs.org/api/modules.html)

Modules reference documentation. Packages are modules.

[NPM](https://www.npmjs.org/)

The Node Package Manager homepage.

[NPM API Docs](https://www.npmjs.org/doc/)

Everything you can do with the `npm` command in the terminal. It's a lot.

## Creating a package

Creating a new package is straightforward. Use the `npm` command line utility and give it a subcommand, such as `init` to create a new package.

So to create a new package, make a new directory and `cd` into it, then initialize the new package in that directory with:

	$ npm init

Npm will ask you for some information about your project. All this command does is create a *package.json* file in the current working directory that contains the information you provided.

We've already seen the *package.json* file when we used `express` to generate our application. Examine it and you'll see information about the application. Examine one generated by the express template and you'll see more information like required dependencies.

Notice our package says there should be an "index.js" file. Go ahead and create it:

	$ touch index.js

## Managing dependencies

The node package manager also handles application dependencies for us. Depdencies are the 3rd party code our application relies on. They often come in the form of *libraries* and *frameworks*, which are collections of re-usable code that other people have written and which we can take advantage of in our projects.

**Installing a new dependency**

Installing dependencies is simple. You just need its name. Install a new package and mark it as a dependency in the package.json file with the following format:

	npm install package-name --save

So for example to install the `underscore` package, type at the console:

	$ npm install underscore --save

NPM adds the package to the `node_modules` folder in the current directory, creating it if necessary, and with the `--save` argument modifies the package.json file to list underscore as a dependency:

	$ ls
	node_modules	package.json index.js
	$ ls node_modules
	underscore
	$ cat package.json
	{
	  	"name": "npm-test",
		...
		"dependencies": {
    		"underscore": "^1.6.0"
  		}
	}

We could then use the `underscore` package from our "index.js" file by requiring it, as we've already seen with modules:

	var _ = require('underscore');

All packages behave like modules in node.

And yes, we're actually assigning the result of `require` to an underscore `_` which is a legal variable name in javascript.

**Installing the listed dependencies**

Saving the dependencies in the package.json file makes it easy to move the our package around later. We don't need to move the dependencies with it, just this *manifest* file which tells npm what dependencies are required. Then we can run `npm install` by itself and it will automatically download and install all the dependencies listed there:

	$ npm install

This is exactly what we do after templating a new application with `express`. The `express` command generates an application template that includes a package.json file. The package.json file lists all the application dependencies:

	"dependencies": {
    	"express": "~4.2.0",
    	"static-favicon": "~1.0.0",
    	"morgan": "~1.0.0",
    	"cookie-parser": "~1.0.1",
   		"body-parser": "~1.0.0",
    	"debug": "~0.7.4",
    	"jade": "~1.3.0"
  	}

The dependencies include express itself! Express is not just a command line utility we use to template our applications, it is also a node library that an express application needs in order to work.

But the `express` *command* doesn't install the *library*, it just lists it as a dependency. Consequently we run `npm install` to have npm download and install all the required depdencies.